<script language="javascript" type="text/javascript">var lan6Cfg;var pfxCfgType;var pdWanConn;var wanIpList;var wanPppList;var lan6Arg={};var wan6ConnName;function initWan(){var index=0;wanIpList=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","X_TP_IPv6Enabled"]);wanPppList=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","X_TP_IPv6Enabled"]);var sel=$.id("pd_wan_conn");if(!$.exe()){for(var i=0;i<wanIpList.length;i++){if(wanIpList[i].enable==1&&wanIpList[i].X_TP_IPv6Enabled==1){var option=$.c("option");option.value=wanIpList[i].__stack;option.text=wanIpList[i].name;try{sel.add(option,null)}catch(e){sel.add(option)}index++;if(lan6Cfg.IPv6SitePrefixConfigType=="Delegated"){if(wanIpList[i].name==lan6Cfg.IPv6PDWANConnection){sel.selectedIndex=index-1}}$.h($.id("curwaninf"),wanIpList[i].name);wan6ConnName=wanIpList[i].name}}for(var i=0;i<wanPppList.length;i++){if(wanPppList[i].enable==1&&wanPppList[i].X_TP_IPv6Enabled==1){var option=$.c("option");option.value=wanPppList[i].__stack;option.text=wanPppList[i].name;try{sel.add(option,null)}catch(e){sel.add(option)}index++;if(lan6Cfg.IPv6SitePrefixConfigType=="Delegated"){if(wanPppList[i].name==lan6Cfg.IPv6PDWANConnection){sel.selectedIndex=index-1}}$.h($.id("curwaninf"),wanPppList[i].name);wan6ConnName=wanPppList[i].name}}if(index==0){var option=$.c("option");option.value=0;option.text=s_str.noAvailIntf;try{sel.add(option,null)}catch(e){sel.add(option)}$.h($.id("curwaninf"),s_str.noAvailIntf);wan6ConnName=""}}}function getWanValue(){var needProcess=0;pdWanConn=wan6ConnName;if(pdWanConn==""){$.alert(ERR_IP6_WAN_CONN_NONE);return false}if(pdWanConn!=lan6Cfg.IPv6PDWANConnection){needProcess=1}for(var i=0;i<wanIpList.length;i++){if(needProcess==1){if((wanIpList[i].name==lan6Cfg.IPv6PDWANConnection)){$.act(ACT_SET,WAN_IP_CONN,wanIpList[i].__stack,null,["X_TP_PDEnabled=0"]);if($.exe()){return false}}}if((wanIpList[i].name==pdWanConn)){if(lan6Arg.IPv6SitePrefixConfigType=="Delegated"){$.act(ACT_SET,WAN_IP_CONN,wanIpList[i].__stack,null,["X_TP_PDEnabled=1"])}else{$.act(ACT_SET,WAN_IP_CONN,wanIpList[i].__stack,null,["X_TP_PDEnabled=0"])}}if($.exe()){return false}}for(var i=0;i<wanPppList.length;i++){if(needProcess==1){if((wanPppList[i].name==lan6Cfg.IPv6PDWANConnection)){$.act(ACT_SET,WAN_PPP_CONN,wanPppList[i].__stack,null,["X_TP_PDEnabled=0"]);if($.exe()){return false}}}if((wanPppList[i].name==pdWanConn)){if(lan6Arg.IPv6SitePrefixConfigType=="Delegated"){$.act(ACT_SET,WAN_PPP_CONN,wanPppList[i].__stack,null,["X_TP_PDEnabled=1"])}else{$.act(ACT_SET,WAN_PPP_CONN,wanPppList[i].__stack,null,["X_TP_PDEnabled=0"])}}if($.exe()){return false}}return true}function checkPrefix(idp,idplen){if(idp.length==0){$.alert(ERR_LAN6_PREFIX_EMPTY);return false}if(idplen.length==0){$.alert(ERR_LAN6_PREFIX_LEN_EMPTY);return false}else{if(idplen!=64){$.alert(ERR_LAN6_PREFIX_LEN_INVALID);return false}}if(!isValidIP6Prefix(idp,idplen)){$.alert(ERR_LAN6_PREFIX_INVALID);return false}return true}function checkDhcp6sParam(){var regExp=/^([a-f]|[A-F]|[0-9]){1,4}$/;var regExp1=/^[0-9]{1,6}$/;var ids=$.id("min_intf_id").value;var ide=$.id("max_intf_id").value;var idl=$.id("ls_time").value;if(ids.length==0){$.alert(ERR_LAN6_DHCP6S_START_ID_EMPTY);return false}if(ide.length==0){$.alert(ERR_LAN6_DHCP6S_END_ID_EMPTY);return false}if(idl.length==0){$.alert(ERR_LAN6_LEASE_TIME_EMPTY);return false}if((0!=idl.length)&&(!regExp1.test(idl))){$.alert(ERR_LAN6_LEASE_TIME_INVALID);return false}if(((0!=ids.length)&&(!regExp.test(ids)))||(0==parseInt(ids,16))||(65535==parseInt(ids,16))){$.alert(ERR_LAN6_DHCP6S_START_ID_INVALID);return false}if(((0!=ide.length)&&(!regExp.test(ide)))||(0==parseInt(ide,16))||(65535==parseInt(ide,16))){$.alert(ERR_LAN6_DHCP6S_END_ID_INVALID);return false}if(parseInt(ids,16)>parseInt(ide,16)){$.alert(ERR_LAN6_DHCP6S_ADDR_CONFLICT);return false}return true}function isValidIP6Prefix(ip6Prefix,prefixLen){var len=0;var flag;var temStr="";var num=0;if(prefixLen<0||prefixLen>128){flag=false}else{flag=true}regExp=/::/;if(flag){if(regExp.test(ip6Prefix)){regExp=/^([a-f]|[A-F]|[0-9])*(::)([a-f]|[A-F]|[0-9])*(::)([a-f]|[A-F]|[0-9])*$/;if(regExp.test(ip6Prefix)){flag=false}else{var index=ip6Prefix.indexOf("::");var len=ip6Prefix.length;var substr1=ip6Prefix.substr(0,index);var substr2=ip6Prefix.substr(index+2,len-index-2);regExp=/^(([a-f]|[A-F]|[0-9]){1,4}(:)){0,6}([a-f]|[A-F]|[0-9]){1,4}$/;var num=0;if(""==substr1&&""==substr2){flag=false}else{if(""==substr2){if(!regExp.test(substr1)){flag=false}}else{if(""==substr1){if(!regExp.test(substr2)){flag=false}}else{if(!regExp.test(substr1)||!regExp.test(substr2)){flag=false}else{if(regExp.test(substr1)&&regExp.test(substr2)){for(var i=0;i<substr1.length;i++){if(substr1.charAt(i)==":"){num+=1}}for(var i=0;i<substr2.length;i++){if(substr1.charAt(i)==":"){num+=1}}if(num>5){flag=false}}}}}}}}else{regExp=/^(([a-f]|[A-F]|[0-9]){1,4}(:)){7}([a-f]|[A-F]|[0-9]){1,4}$/;if(!regExp.test(ip6Prefix)){flag=false}}}return flag}function getSitePrefix(address){var i=0;var zeroNum=0;var count=0;var sitePrefix="";var addrParts=address.split(":");if(-1==address.indexOf("::")){for(i=0;i<4;i++){sitePrefix=sitePrefix.concat(addrParts[i]);if(i!=3){sitePrefix=sitePrefix.concat(":")}else{sitePrefix=sitePrefix.concat("::")}}return sitePrefix}zeroNum=9-addrParts.length;for(i=0;i<addrParts.length;i++){if(addrParts[i]!=""){sitePrefix=sitePrefix.concat(addrParts[i]);sitePrefix=sitePrefix.concat(":");count++}else{if(i<4){for(;zeroNum>0;zeroNum--){sitePrefix=sitePrefix.concat("0:");count++;if(4==count){break}}}}if(4==count){break}}sitePrefix=sitePrefix.concat(":");return sitePrefix}function changePfxMode(){if($.id("pfx_static").checked){$.id("site_pfx").value="";$.id("site_plen").value=64;$.removeClass($.id("pfx_opt"),"nd");$.addClass($.id("pd_opt"),"nd")}else{$.addClass($.id("pfx_opt"),"nd");$.removeClass($.id("pd_opt"),"nd")}}function changeAddrMode(){if($.id("dhcp6s_en").checked){$.removeClass($.id("dhcp6s_opt"),"nd");$.addClass($.id("radvd_opt"),"nd")}else{$.addClass($.id("dhcp6s_opt"),"nd");$.removeClass($.id("radvd_opt"),"nd")}}function enableULA(){if($.id("ula_en").checked){$.removeClass($.id("ula_opt"),"nd")}else{$.addClass($.id("ula_opt"),"nd")}}function init(){var brList=$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]);var IPv6Cfg=$.act(ACT_GET,IPV6_CFG,null,null);if(!$.exe()){for(var index=0;index<brList.length;index++){if(brList[index].bridgeName=="Default"){lan6Cfg=$.act(ACT_GET,LAN_IP6_HOST_CFG,brList[index].__stack,null,null);if(!$.exe()){if(brList[index].bridgeName=="Default"){$.h($.id("brname"),m_str.def)}else{$.h($.id("brname"),brList[index].bridgeName)}$.id("radvd_en").checked=(lan6Cfg.RADVDEnable==1)?1:0;$.id("rdnss_en").checked=(lan6Cfg.RDNSSEnable==1)?1:0;$.id("ula_en").checked=(lan6Cfg.ULAEnable==1)?1:0;$.id("dhcp6s_en").checked=(lan6Cfg.DHCPv6ServerEnable==1)?1:0;$.id("pfx_delegated").checked=(lan6Cfg.IPv6SitePrefixConfigType=="Delegated")?1:0;$.id("pfx_static").checked=(lan6Cfg.IPv6SitePrefixConfigType=="Static")?1:0;changePfxMode();$.id("ula_pfx").value=(lan6Cfg.ULAPrefix)?lan6Cfg.ULAPrefix:"";$.id("ula_plen").value=(lan6Cfg.ULAPrefixLength)?lan6Cfg.ULAPrefixLength:"";$.id("site_pfx").value=(lan6Cfg.IPv6SitePrefix)?lan6Cfg.IPv6SitePrefix:"";$.id("site_plen").value=(lan6Cfg.IPv6SitePrefixLength)?lan6Cfg.IPv6SitePrefixLength:"";$.h($.id("start_pfx"),(lan6Cfg.IPv6SitePrefix)?lan6Cfg.IPv6SitePrefix:"::");$.h($.id("end_pfx"),(lan6Cfg.IPv6SitePrefix)?lan6Cfg.IPv6SitePrefix:"::");$.id("min_intf_id").value=(lan6Cfg.DHCPv6ServerEnable)?lan6Cfg.DHCPv6MinInterfaceID:"1";$.id("max_intf_id").value=(lan6Cfg.DHCPv6ServerEnable)?lan6Cfg.DHCPv6MaxInterfaceID:"FFFE";$.id("ls_time").value=(lan6Cfg.DHCPv6ServerEnable)?lan6Cfg.DHCPv6LeaseTime:"86400"}initWan();break}}enableULA();changeAddrMode();if(IPv6Cfg.disableIPv6==1){$.each(document.getElementsByTagName("input"),function(){this.disabled=true})}}}function formatIPv6(address){address=address.replace(/:(0){1,4}/g,":0");address=address.replace(/(?!((:0:)|(:0$)))(:0)/g,":");if(-1==address.indexOf("::")){address=address.replace(/(:0)+:/,"::")}else{address=address.replace(/(:0)*::/,"::")}return address}function doSave(){lan6Arg.IPv6SitePrefixConfigType=($.id("pfx_delegated").checked==1)?"Delegated":"Static";if(lan6Arg.IPv6SitePrefixConfigType=="Static"){if(!checkPrefix($.id("site_pfx").value,$.id("site_plen").value)){return}lan6Arg.IPv6SitePrefix=formatIPv6(getSitePrefix($.id("site_pfx").value));lan6Arg.IPv6SitePrefixLength=$.id("site_plen").value;lan6Arg.IPv6DNSServers=(lan6Cfg.IPv6DNSServers)?lan6Cfg.IPv6DNSServers:"::"}lan6Arg.RADVDEnable=($.id("radvd_en").checked==1)?1:0;lan6Arg.ULAEnable=($.id("ula_en").checked==1)?1:0;if(lan6Arg.ULAEnable==1){if(!checkPrefix($.id("ula_pfx").value,$.id("ula_plen").value)){return}lan6Arg.ULAPrefix=formatIPv6($.id("ula_pfx").value);lan6Arg.ULAPrefixLength=$.id("ula_plen").value}lan6Arg.RDNSSEnable=($.id("rdnss_en").checked==1)?1:0;lan6Arg.DHCPv6ServerEnable=($.id("dhcp6s_en").checked==1)?1:0;if(lan6Arg.DHCPv6ServerEnable==1){if(!checkDhcp6sParam()){return}lan6Arg.DHCPv6MinInterfaceID=$.id("min_intf_id").value;lan6Arg.DHCPv6MaxInterfaceID=$.id("max_intf_id").value;lan6Arg.DHCPv6LeaseTime=$.id("ls_time").value}if(!getWanValue()){return}if(lan6Arg.IPv6SitePrefixConfigType!="Static"){lan6Arg.IPv6PDWANConnection=pdWanConn}$.addLoading($.id("saveBtn"));$.act(ACT_SET,LAN_IP6_HOST_CFG,lan6Cfg.__stack,null,lan6Arg);$.exe(function(err){if(!err){$.loadMain("lan6.htm")}})};</script>
<p class="et T" id="et">IPv6 LAN Settings</p>
<div class="con1 L">
<p class="ct"></p> 
<p class="bl"></p>
<div class="con2">
<p class="L1 T" id="t_info">The parameters of IPv6 LAN can be configured on this page when IPv6 is enabled.</p>
<p class="L1 T" id="t_note">Note: Only default group supports IPv6 now.</p>
<p class="br"></p>
<p class="L2"><b class="item L T T_group">Group:</b><b style="padding-left:12px" id="brname"></b></p>
<p class="L2"><b class="item L T" id="t_addrtype">Address Autoconfiguration Type:</b>
<input name="addrMode" type="radio" id="radvd_en" onclick="changeAddrMode();"/>RADVD
<input name="addrMode" type="radio" id="dhcp6s_en" onclick="changeAddrMode();"/><span id="t_dhcp6s">DHCPv6 Server</span>
</p>
<div id="radvd_opt">
<p class="L2"><b class="item L T" id="t_rdnss">Enable RDNSS:</b><input type="checkbox" id="rdnss_en"/></p>
<p class="L2"><b class="item L T" id="t_ula">Enable ULA Prefix:</b><input type="checkbox" id="ula_en" onclick="enableULA();"/></p>
<div id="ula_opt">
<p class="L2"><b class="item L T" id="t_ulapfx">ULA Prefix:</b><input id="ula_pfx" type="text" class="text" size="21" value="" maxlength="21"/></p>
<p class="L2"><b class="item L T" id="t_ulaplen">ULA Prefix Length:</b><input id="ula_plen" type="text" class="text" value="" size="4" maxlength="4"/></p>
</div>
</div>
<div id="dhcp6s_opt">
<p class="L2"><b class="item L T" id="t_startaddr">Start IPv6 Address:</b><b style="padding-left:12px" id="start_pfx"></b><input type="text" class="text" id="min_intf_id" value="" size="4" maxlength="4"/>(1~FFFE)</p>
<p class="L2"><b class="item L T" id="t_endaddr">End IPv6 Address:</b><b style="padding-left:12px" id="end_pfx"></b><input type="text" class="text" id="max_intf_id" value="" size="4" maxlength="4" />(1~FFFE)</p>
<p class="L2"><b class="item L T" id="t_lstime">Leased Time:</b><input type="text" class="text" id="ls_time" value="" size="6"  maxlength="6"/><span class="T" id="t_lssec">seconds (The default value is 86400)</span></p>
</div>
<p class="br"></p>
<p class="L2"><b class="item L T" id="t_pfxtype">Site Prefix Configuration Type:</b>
<input name="pfxMode" type="radio" id="pfx_delegated" onclick="changePfxMode();"/><span class="T" id="t_delegated">Delegated</span>
<input name="pfxMode" type="radio" id="pfx_static" onclick="changePfxMode();"/><span class="T" id="t_static">Static</span>
</p>
<div id="pd_opt">
<p class="L2 nd"><b class="item L T" id="t_wan">Prefix Delegated WAN Connection:</b><select id="pd_wan_conn"></select></p>
<p class="L2"><b class="item L T" id="t_cur_wan">Prefix Delegated WAN Connection:</b><span id="curwaninf"></span></p>
</div>
<div id="pfx_opt">
<p class="L2"><b class="item L T" id="t_pfx">Site Prefix:</b><input id="site_pfx" type="text" class="text" size="21" value="" maxlength="21"/></p>
<p class="L2"><b class="item L T" id="t_plen">Site Prefix Length:</b><input id="site_plen" type="text" class="text" value="" size="4" maxlength="4"/></p>
</div>
</div>
<p class="bl"></p>
<p class="tail" id="tail"><input type="button" class="button L T T_save" id="saveBtn" value="Save" onclick="doSave();"/></p>
</div>
<script language="javascript" type="text/javascript">$.loadHelpFrame("IPv6LanHelp.htm");init();</script>
