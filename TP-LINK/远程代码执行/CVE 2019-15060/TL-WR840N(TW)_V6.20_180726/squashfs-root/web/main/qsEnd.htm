<script language="javascript" type="text/javascript">var pvc;var newname;var newIfname;var defaultHostname;var needReboot=false;var commitArray=new Array();function saveVlanCfg(){function setVlanCfg(obj,doAct,isp,porttype){var lanPort=0;var ispService=isp;var services=porttype;for(var j=0;j<ispService.length;j++){var found=false;for(var i=1;i<services.length;i++){if(services[i].name==ispService[j].name){found=true;break}}if(!found){if(ispService[j].enable=="1"){needReboot=true}if(doAct){$.act(ACT_DEL,ISP_SERVICE,ispService[j].__stack)}}}for(var i=1;i<services.length;i++){var ispObj={};var found=false;ispObj.name=services[i].name;ispObj.enable=obj.vlanSetting[services[i].name].enable?"1":"0";ispObj.vlanID=obj.vlanSetting[services[i].name].vlanID;ispObj.priority=obj.vlanSetting[services[i].name].priority;ispObj.extendID=obj.vlanSetting[services[i].name].extendID;ispObj.untag=obj.vlanSetting[services[i].name].untag;ispObj.lanPort=obj.vlanSetting[services[i].name].lanPort;lanPort+=ispObj.lanPort;for(var j=0;j<ispService.length;j++){if(services[i].name==ispService[j].name){found=true;if(ispObj.enable!=ispService[j].enable||ispObj.vlanID!=ispService[j].vlanID||ispObj.priority!=ispService[j].priority||ispObj.extendID!=ispService[j].extendID||ispObj.untag!=ispService[j].untag||ispObj.lanPort!=ispService[j].lanPort){needReboot=true}if(doAct){$.act(ACT_SET,ISP_SERVICE,ispService[j].__stack,null,ispObj)}break}}if(!found){if(ispObj.enable!="0"){needReboot=true}if(doAct){$.act(ACT_ADD,ISP_SERVICE,null,null,ispObj)}}}var tmpObj={};tmpObj.workingMode=obj.workingMode;tmpObj.enable="1";tmpObj.internetGroupVlanID=obj.vlanSetting[services[0].name].vlanID;tmpObj.internetGroupExtendID=obj.vlanSetting[services[0].name].extendID;tmpObj.internetGroupPriority=obj.vlanSetting[services[0].name].priority;tmpObj.internetGroupLanPort=255-lanPort;tmpObj.internetUntag=obj.vlanSetting[services[0].name].untag;if((tmpObj.workingMode!=vlanObj.workingMode&&vlanObj.workingMode!="")||(tmpObj.workingMode!="automatic"&&vlanObj.workingMode=="")||tmpObj.enable!=vlanObj.enable||tmpObj.internetGroupVlanID!=vlanObj.internetGroupVlanID||tmpObj.internetGroupExtendID!=vlanObj.internetGroupExtendID||tmpObj.internetGroupPriority!=vlanObj.internetGroupPriority||tmpObj.internetGroupLanPort!=vlanObj.internetGroupLanPort||tmpObj.internetUntag!=vlanObj.internetUntag){needReboot=true}if(doAct){$.act(ACT_SET,VLAN,null,null,tmpObj)}}if($.qd.vlancfg.enable_adv==1){if(($.qd.vlancfg.workingMode!=vlanObj.workingMode&&vlanObj.workingMode!="")||($.qd.vlancfg.workingMode!="automatic"&&vlanObj.workingMode=="")){needReboot=true}setVlanCfg($.qd.vlancfg.currVlan,true,ispService,services)}return true}function pushToCommitStack(type,oid,stack,pStack,attrs){var curLength=commitArray.length;commitArray[curLength]={};commitArray[curLength].type=type;commitArray[curLength].oid=oid;commitArray[curLength].stack=stack;commitArray[curLength].pStack=pStack;commitArray[curLength].attrs=attrs}function commitStack(){if(commitArray.length==0){return true}var data={};for(var idex in commitArray){data=commitArray[idex];$.act(data.type,data.oid,data.stack,data.pStack,data.attrs)}$.exe(true)}function setDefaultHostname(){var c;var ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.";var i=0;var hostname="";var hostnameLen=0;for(i=0;i<$.model.length;i++){c=$.model.charAt(i);if(ch.indexOf(c)==-1){if(hostnameLen==0||(hostnameLen>0&&hostname.charAt(hostnameLen-1)=="_")){continue}else{hostname+="_";hostnameLen++}}else{hostname+=c;hostnameLen++}}defaultHostname=(hostnameLen>0&&hostname.charAt(hostnameLen-1)=="_")?hostname.substr(0,hostnameLen-1):hostname}function doSave(){var list;var instance;var stack;var arg;switch($.qd.step){case 0:if(INCLUDE_WAN_MODE){$.removeClass($.id("p_sysMode"),"nd");$.addLoading($.id("s_sysMode"));$.act(ACT_SET,SYS_MODE,null,null,{mode:$.qd.sysMode});$.exe(function(ret){if(ret){return doErr(ret)}else{$.removeLoading();$.h($.id("s_sysMode"),"<span class='T T_success'>"+m_str.success+"</span>");if($.qd.sysMode=="DSL"){$.qd.step++}else{$.qd.step=$.qd.step+2}doSave()}},true)}else{$.qd.step++;doSave()}break;case 1:if(INCLUDE_AUTO_PVC&&$.qd.dsl.auto){$.removeClass($.id("p_auto"),"nd");$.addLoading($.id("s_auto"));arg={};arg.linkType=$.qd.type=="ppp"&&"PPPoE"||$.qd.type=="dhcp"&&"DHCP"||$.qd.type=="staip"&&"Static"||"Bridge";if($.qd.type=="staip"){arg.ipAddr=$.qd.staip.ip;arg.gwAddr=$.qd.staip.gw}$.act(ACT_CGI,"/cgi/pvc",null,null,arg);$.exe(function(ret){if(ret){return doErr(ret)}$.auto(function(){var autores=$.act(ACT_GET,WAN_DSL_AUTOPVC,$.qd.dsl.wan);if(!$.exe(null,true)){if(autores.searchState<=1){return}$.qd.step++;if(autores.searchState==2){$.removeLoading();$.h($.id("s_auto"),"<span class='T T_success'>"+m_str.success+"</span>");pvc=autores.detectedVpi+"/"+autores.detectedVci;$.h($.id("s_pvc"),pvc);$.removeClass($.id("p_pvc"),"nd");doSave()}else{$.removeLoading();$.h($.id("s_auto"),"<i class='T T_failed'>"+m_str.failed+"</i>");$.removeClass($.id("con_pvc"),"nd");$.removeClass($.id("doCont"),"nd");$.unlock()}return false}},500,true);return},true)}else{pvc=$.qd.dsl.vpi+"/"+$.qd.dsl.vci;$.qd.step++;doSave()}break;case 2:if($.qd.del&&$.qd.del.length){$.removeClass($.id("p_del"),"nd");$.addLoading($.id("s_del"));var stacks=[];var pvcs=[];while(instance=$.qd.del.shift()){stack=$.stkPop(instance.stack);$.act(ACT_DEL,instance.type=="ppp"?WAN_PPP_CONN:WAN_IP_CONN,instance.stack);if(!$.inArray(stack,stacks)){stacks.push(stack)}}while(stack=stacks.shift()){pvcs.push($.act(ACT_GET,WAN_CONN_DEVICE,stack))}$.exe(function(ret){if(ret){return doErr(ret)}while(instance=pvcs.shift()){if(instance.WANIPConnectionNumberOfEntries==0&&instance.WANPPPConnectionNumberOfEntries==0){$.act(ACT_DEL,WAN_CONN_DEVICE,instance.__stack)}}$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_del"),"<span class='T T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true)},true)}else{$.qd.step++;doSave()}break;case 3:if(!INCLUDE_WAN_MODE||$.qd.sysMode=="DSL"){$.removeClass($.id("p_wan"),"nd");$.addLoading($.id("s_wan"));var list=$.act(ACT_GL,WAN_DSL_LINK_CFG,null,null,["destinationAddress"]);$.exe(function(ret){if(ret){return doErr(ret)}setDefaultHostname();var doAdd=function(){if($.qd.type=="ppp"||$.qd.type=="pppoa"){instance=$.act(ACT_ADD,WAN_PPP_CONN,null,stack,{name:"",enable:1,transportType:$.qd.type=="ppp"?"PPPoE":"PPPoA",username:$.qd[$.qd.type].usr,password:$.qd[$.qd.type].pwd,X_TP_IfName:""})}else{if($.qd.type=="dhcp"){instance=$.act(ACT_ADD,WAN_IP_CONN,null,stack,{name:"",enable:1,connectionType:"IP_Routed",addressingType:"DHCP",NATEnabled:1,X_TP_Hostname:defaultHostname,X_TP_IfName:""})}else{if($.qd.type=="staip"||$.qd.type=="ipoa"){instance=$.act(ACT_ADD,WAN_IP_CONN,null,stack,{name:"",X_TP_IfName:"",enable:1,connectionType:"IP_Routed",addressingType:"Static",NATEnabled:1,externalIPAddress:$.qd[$.qd.type].ip,subnetMask:$.qd[$.qd.type].mask,defaultGateway:$.qd[$.qd.type].gw,DNSOverrideAllowed:1,DNSServers:$.qd[$.qd.type].dns+","+$.qd[$.qd.type].dns2})}else{if($.qd.type=="br"){$.act(ACT_ADD,WAN_IP_CONN,null,stack,{enable:1,connectionType:"IP_Bridged"})}}}}$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();if($.qd.type!="br"){newname=instance.name;newIfname=instance.X_TP_IfName}$.h($.id("s_wan"),"<span class='T T_success'>"+m_str.success+"</span>");if(INCLUDE_USB_3G_DONGLE){$.removeClass($.id("p_3g"),"nd");$.addLoading($.id("s_3g"));$.act(ACT_SET,WAN_USB_3G_LINK_CFG,$.qd.usb3g.linkCfgStk,null,{backupEnable:$.qd.usb3g.enable,userSaved:$.qd.usb3g.userSaved,locationIdx:$.qd.usb3g.locationIdx,ispIdx:$.qd.usb3g.ispIdx,manualAPN:$.qd.usb3g.manualAPN,dialNumber:$.qd.usb3g.dial_num,APN:$.qd.usb3g.apn});$.act(ACT_SET,WAN_PPP_CONN,PPP3GStk,null,{username:$.qd.usb3g.username,password:$.qd.usb3g.password,PPPAuthenticationProtocol:$.qd.usb3g.auth});$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_3g"),"<span class='T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true)}else{$.qd.step++;doSave()}},true)};if($.each(list,function(){if(this.destinationAddress.split(":")[1]==pvc){stack=this.__stack;return false}})){instance=$.act(ACT_ADD,WAN_CONN_DEVICE,null,$.qd.dsl.wan);$.exe(function(ret){if(ret){return doErr(ret)}stack=instance.__stack;$.act(ACT_SET,WAN_DSL_LINK_CFG,stack,null,{enable:1,destinationAddress:"PVC:"+pvc,LinkType:$.qd.type=="pppoa"&&"PPPoA"||$.qd.type=="ipoa"&&"IPoA"||"EoA",ATMEncapsulation:$.qd.type=="pppoa"?"VCMUX":"LLC"});doAdd()},true)}else{doAdd()}},true)}if(INCLUDE_WAN_MODE&&$.qd.sysMode=="ETH"){if($.qd.type){$.removeClass($.id("p_wan"),"nd");$.addLoading($.id("s_wan"));var pStk;var staticStk;var dynStk;var PPPoEStk;var L2tpStk;var PptpStk;var bpaStk;var wanIPList=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","addressingType","X_TP_IPv4Enabled","X_TP_BpaEnable"]);var wanPPPList=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","transportType","X_TP_IPv4Enabled"]);var wanL2tpList=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","addressingType","transportType"]);var wanPptpList=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","addressingType","transportType"]);var wanTypes=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);if($.qd.type=="dhcp"){var devInfo=$.act(ACT_GET,IGD_DEV_INFO,null,null,["modelName"])}$.act(ACT_CGI,"/cgi/info");$.exe(function(ret){if(ret){return doErr(ret)}$.each(wanTypes,function(){if(this.WANAccessType=="Ethernet"){pStk=this.__stack}});$.each(wanIPList,function(){var tmpStk=$.stkPop(this.__stack,2);if(pStk==tmpStk&&this.X_TP_IPv4Enabled==1){if(this.addressingType=="Static"){staticStk=this.__stack}if(this.addressingType=="DHCP"){if(this.X_TP_BpaEnable==1){bpaStk=this.__stack}else{dynStk=this.__stack}}}});$.each(wanPPPList,function(){var tmpStk=$.stkPop(this.__stack,2);if(pStk==tmpStk&&this.X_TP_IPv4Enabled==1){if(this.transportType=="PPPoE"){PPPoEStk=this.__stack}}});$.each(wanL2tpList,function(){var tmpStk=$.stkPop(this.__stack,1);if(pStk==tmpStk){l2tpStk=this.__stack}});$.each(wanPptpList,function(){var tmpStk=$.stkPop(this.__stack,1);if(pStk==tmpStk){pptpStk=this.__stack}});if($.qd.type=="ppp"){$.act(ACT_SET,WAN_ETH_INTF,pStk,null,["X_TP_lastUsedIntf=pppoe_eth3_d"]);$.act(ACT_SET,WAN_L2TP_CONN,l2tpStk,null,{enable:0});$.act(ACT_SET,WAN_PPTP_CONN,pptpStk,null,{enable:0});$.act(ACT_SET,WAN_PPP_CONN,PPPoEStk,null,{enable:1,username:$.qd.ppp.usr,password:$.qd.ppp.pwd,secondConnection:$.qd.ppp.secondConnection});if(INCLUDE_DUAL_ACCESS){if($.qd.ppp.secondConnection=="sec_conn_dynip"){var wan_iplistarg_dyn={};wan_iplistarg_dyn.enable=1;$.act(ACT_SET,WAN_IP_CONN,staticStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,dynStk,null,wan_iplistarg_dyn)}else{if($.qd.ppp.secondConnection=="sec_conn_staip"){var wan_iplistarg_sta={};wan_iplistarg_sta.externalIPAddress=$.qd.ppp.externalIPAddress;wan_iplistarg_sta.subnetMask=$.qd.ppp.subnetMask;wan_iplistarg_sta.enable=1;wan_iplistarg_sta.defaultGateway="0.0.0.0";wan_iplistarg_sta.DNSServers="0.0.0.0,0.0.0.0";$.act(ACT_SET,WAN_IP_CONN,dynStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,staticStk,null,wan_iplistarg_sta)}else{$.act(ACT_SET,WAN_IP_CONN,dynStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,staticStk,null,{enable:0})}}}else{$.act(ACT_SET,WAN_IP_CONN,dynStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,staticStk,null,{enable:0})}instance=$.act(ACT_GET,WAN_PPP_CONN,PPPoEStk,null,["name","X_TP_IfName"])}else{if($.qd.type=="dhcp"){setDefaultHostname();$.act(ACT_SET,WAN_ETH_INTF,pStk,null,["X_TP_lastUsedIntf=ipoe_eth3_d"]);$.act(ACT_SET,WAN_PPP_CONN,PPPoEStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,staticStk,null,{enable:0});$.act(ACT_SET,WAN_L2TP_CONN,l2tpStk,null,{enable:0});$.act(ACT_SET,WAN_PPTP_CONN,pptpStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,dynStk,null,{enable:1,NATEnabled:1,X_TP_Hostname:defaultHostname});instance=$.act(ACT_GET,WAN_IP_CONN,dynStk,null,["name","X_TP_IfName"]);if($.qd.macclone==1){$.each(wanIPList,function(){$.act(ACT_SET,WAN_IP_CONN,this.__stack,null,["MACAddressOverride=1","X_TP_ClonedMACAddress="+clientMac])});$.each(wanPPPList,function(){$.act(ACT_SET,WAN_PPP_CONN,this.__stack,null,["MACAddressOverride=1","X_TP_ClonedMACAddress="+clientMac])});$.each(wanL2tpList,function(){$.act(ACT_SET,WAN_L2TP_CONN,this.__stack,null,["MACAddressOverride=1","clonedMACAddress="+clientMac])});$.each(wanPptpList,function(){$.act(ACT_SET,WAN_PPTP_CONN,this.__stack,null,["MACAddressOverride=1","clonedMACAddress="+clientMac])})}else{if($.qd.macclone==0){$.each(wanIPList,function(){$.act(ACT_SET,WAN_IP_CONN,this.__stack,null,["MACAddressOverride=0","X_TP_ClonedMACAddress="])});$.each(wanPPPList,function(){$.act(ACT_SET,WAN_PPP_CONN,this.__stack,null,["MACAddressOverride=0","X_TP_ClonedMACAddress="])});$.each(wanL2tpList,function(){$.act(ACT_SET,WAN_L2TP_CONN,this.__stack,null,["MACAddressOverride=0","clonedMACAddress="])});$.each(wanPptpList,function(){$.act(ACT_SET,WAN_PPTP_CONN,this.__stack,null,["MACAddressOverride=0","clonedMACAddress="])})}}}else{if($.qd.type=="staip"){$.act(ACT_SET,WAN_ETH_INTF,pStk,null,["X_TP_lastUsedIntf=ipoe_eth3_s"]);$.act(ACT_SET,WAN_PPP_CONN,PPPoEStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,dynStk,null,{enable:0});$.act(ACT_SET,WAN_L2TP_CONN,l2tpStk,null,{enable:0});$.act(ACT_SET,WAN_PPTP_CONN,pptpStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,staticStk,null,{enable:1,NATEnabled:1,externalIPAddress:$.qd.staip.ip,subnetMask:$.qd.staip.mask,defaultGateway:$.qd.staip.gw,DNSOverrideAllowed:1,DNSServers:$.qd.staip.dns+","+$.qd.staip.dns2});instance=$.act(ACT_GET,WAN_IP_CONN,staticStk,null,["name","X_TP_IfName"])}else{if($.qd.type=="l2tp"){$.act(ACT_SET,WAN_ETH_INTF,pStk,null,["X_TP_lastUsedIntf=l2tp_eth3_d"]);$.act(ACT_SET,WAN_PPP_CONN,PPPoEStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,staticStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,dynStk,null,{enable:0});$.act(ACT_SET,WAN_PPTP_CONN,pptpStk,null,{enable:0});$.act(ACT_SET,WAN_L2TP_CONN,l2tpStk,null,{enable:1,username:$.qd.l2tp.usr,password:$.qd.l2tp.pwd,serverIpOrName:$.qd.l2tp.server,addressingType:$.qd.l2tp.addrtype});if($.qd.l2tp.addrtype=="Static"){$.act(ACT_SET,WAN_L2TP_CONN,l2tpStk,null,{externalIPAddressIP:$.qd.l2tp.ip,subnetMaskIP:$.qd.l2tp.mask,defaultGatewayIP:$.qd.l2tp.gw,DNSServersIP:$.qd.l2tp.dns+","+$.qd.l2tp.dns2})}instance=$.act(ACT_GET,WAN_L2TP_CONN,l2tpStk,null,["name","ifName"])}else{if($.qd.type=="pptp"){$.act(ACT_SET,WAN_ETH_INTF,pStk,null,["X_TP_lastUsedIntf=pptp_eth3_d"]);$.act(ACT_SET,WAN_PPP_CONN,PPPoEStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,staticStk,null,{enable:0});$.act(ACT_SET,WAN_IP_CONN,dynStk,null,{enable:0});$.act(ACT_SET,WAN_L2TP_CONN,l2tpStk,null,{enable:0});$.act(ACT_SET,WAN_PPTP_CONN,pptpStk,null,{enable:1,username:$.qd.pptp.usr,password:$.qd.pptp.pwd,serverIpOrName:$.qd.pptp.server,addressingType:$.qd.pptp.addrtype});if($.qd.pptp.addrtype=="Static"){$.act(ACT_SET,WAN_PPTP_CONN,l2tpStk,null,{externalIPAddressIP:$.qd.pptp.ip,subnetMaskIP:$.qd.pptp.mask,defaultGatewayIP:$.qd.pptp.gw,DNSServersIP:$.qd.pptp.dns+","+$.qd.pptp.dns2})}instance=$.act(ACT_GET,WAN_PPTP_CONN,pptpStk,null,["name","ifName"])}}}}}$.act(ACT_SET,WAN_IP_CONN,bpaStk,null,{enable:0});$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();if($.qd.type!="br"){newname=instance.name;newIfname=instance.X_TP_IfName}$.h($.id("s_wan"),"<span class='T T_success'>"+m_str.success+"</span>");if(INCLUDE_USB_3G_DONGLE){$.removeClass($.id("p_3g"),"nd");$.addLoading($.id("s_3g"));$.act(ACT_SET,WAN_USB_3G_LINK_CFG,$.qd.usb3g.linkCfgStk,null,{backupEnable:$.qd.usb3g.enable,userSaved:$.qd.usb3g.userSaved,locationIdx:$.qd.usb3g.locationIdx,ispIdx:$.qd.usb3g.ispIdx,manualAPN:$.qd.usb3g.manualAPN,dialNumber:$.qd.usb3g.dial_num,APN:$.qd.usb3g.apn});$.act(ACT_SET,WAN_PPP_CONN,PPP3GStk,null,{username:$.qd.usb3g.username,password:$.qd.usb3g.password,PPPAuthenticationProtocol:$.qd.usb3g.auth});$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_3g"),"<span class='T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true)}else{$.qd.step++;doSave()}},true)},true)}else{$.qd.step=5;doSave()}}if(INCLUDE_WAN_MODE&&INCLUDE_USB_3G_DONGLE&&$.qd.sysMode=="USB_3G"){$.removeClass($.id("p_3g"),"nd");$.addLoading($.id("s_3g"));$.act(ACT_SET,WAN_USB_3G_LINK_CFG,$.qd.usb3g.linkCfgStk,null,{backupEnable:$.qd.usb3g.enable,userSaved:$.qd.usb3g.userSaved,locationIdx:$.qd.usb3g.locationIdx,ispIdx:$.qd.usb3g.ispIdx,manualAPN:$.qd.usb3g.manualAPN,dialNumber:$.qd.usb3g.dial_num,APN:$.qd.usb3g.apn});$.act(ACT_SET,WAN_PPP_CONN,PPP3GStk,null,{username:$.qd.usb3g.username,password:$.qd.usb3g.password,PPPAuthenticationProtocol:$.qd.usb3g.auth});$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_3g"),"<span class='T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true)}break;case 4:if(INCLUDE_WAN_MODE&&INCLUDE_USB_3G_DONGLE&&$.qd.sysMode=="USB_3G"){$.qd.step++;doSave()}else{if($.qd.type!="br"){$.removeClass($.id("p_gw"),"nd");$.addLoading($.id("s_gw"));$.act(ACT_SET,L3_FORWARDING,null,null,{__ifAliasName:newname,__ifName:"",defaultConnectionService:""});$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_gw"),"<span class='T T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true)}else{$.qd.step++;doSave()}}break;case 5:if(!$.qd.vlancfg){return doSave($.qd.step++)}$.removeClass($.id("p_vlan"),"nd");$.addLoading($.id("s_vlan"));saveVlanCfg();$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_vlan"),"<span class='T T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true);break;case 6:if(!$.qd.wl){return doSave($.qd.step++)}if(INCLUDE_LAN_WLAN_DUALBAND){$.removeClass($.id("p_wl2g"),"nd");$.addLoading($.id("s_wl2g"))}else{$.removeClass($.id("p_wl"),"nd");$.addLoading($.id("s_wl"))}arg2g={};if($.qd.wl.en){arg2g.enable=1;arg2g.SSID=$.qd.wl.ssid;if($.qd.wl.domain!=$.qd.dmRegion){arg2g.regulatoryDomain=$.qd.wl.domain}if($.qd.wl.chnn=="auto"){arg2g.autoChannelEnable=1}else{arg2g.autoChannelEnable=0;arg2g.channel=$.qd.wl.chnn}if($.qd.wl.mode=="n-only"){arg2g.standard="n-only"}else{if($.qd.wl.mode=="n"){arg2g.standard="n"}else{arg2g.standard=$.qd.wl.mode}}arg2g.X_TP_Bandwidth=$.qd.wl.bandwidth;if($.qd.wl.sec){arg2g.beaconType="11i";if($.qd.wl.mode=="n-only"){arg2g.IEEE11iEncryptionModes="AESEncryption";arg2g.WPAEncryptionModes="AESEncryption";arg2g.WPAAuthenticationMode="PSKAuthentication";arg2g.IEEE11iAuthenticationMode="PSKAuthentication"}else{arg2g.IEEE11iEncryptionModes="AESEncryption";arg2g.WPAEncryptionModes="AESEncryption";arg2g.WPAAuthenticationMode="PSKAuthentication";arg2g.IEEE11iAuthenticationMode="PSKAuthentication"}arg2g.X_TP_PreSharedKey=$.qd.wl.pwd}else{arg2g.beaconType="Basic";arg2g.basicEncryptionModes="None";arg2g.BasicAuthenticationMode="None"}}else{arg2g.enable=0;if($.qd.wl.domain!=$.qd.dmRegion){arg2g.regulatoryDomain=$.qd.wl.domain;arg2g.autoChannelEnable=1}}if(needReboot==false){if(!INCLUDE_LAN_WLAN_DUALBAND){$.act(ACT_SET,LAN_WLAN,$.qd.wl.stack,null,arg2g)}$.exe(function(ret){if(ret){return doErr(ret)}if(INCLUDE_LAN_WLAN_DUALBAND){if($.qd.wl.en||$.qd.wl5g.en){var timeout=3000}else{var timeout=1000}setTimeout(function(){$.removeLoading();$.h($.id("s_wl2g"),"<span class='T T_success'>"+m_str.success+"</span>");$.removeClass($.id("p_wl5g"),"nd");$.addLoading($.id("s_wl5g"))},timeout)}else{$.removeLoading();$.h($.id("s_wl"),"<span class='T T_success'>"+m_str.success+"</span>")}$.qd.step++;doSave()},true)}else{if(!INCLUDE_LAN_WLAN_DUALBAND){pushToCommitStack(ACT_SET,LAN_WLAN,$.qd.wl.stack,null,arg2g);setTimeout(function(){$.removeLoading();$.h($.id("s_wl"),"<span class='T T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},1000)}else{setTimeout(function(){$.removeLoading();$.h($.id("s_wl2g"),"<span class='T T_success'>"+m_str.success+"</span>");$.removeClass($.id("p_wl5g"),"nd");$.addLoading($.id("s_wl5g"));$.qd.step++;doSave()},1000)}}break;case 7:if(!$.qd.wl5g){return doSave($.qd.step++)}arg5g={};if($.qd.wl5g.en){arg5g.enable=1;arg5g.SSID=$.qd.wl5g.ssid;if($.qd.wl5g.domain!=$.qd.dmRegion){arg5g.regulatoryDomain=$.qd.wl5g.domain}if($.qd.wl5g.chnn=="auto"){arg5g.autoChannelEnable=1}else{arg5g.autoChannelEnable=0;arg5g.channel=$.qd.wl5g.chnn}if($.qd.wl5g.mode=="n-only"){arg5g.standard="n-only"}else{if($.qd.wl5g.mode=="an"){arg5g.standard="an"}else{if($.qd.wl5g.mode=="ac"){arg5g.standard="ac"}else{arg5g.standard=$.qd.wl5g.mode}}}arg5g.X_TP_Bandwidth=$.qd.wl5g.bandwidth;if($.qd.wl5g.sec){arg5g.beaconType="11i";if($.qd.wl5g.mode=="n-only"){arg5g.IEEE11iEncryptionModes="AESEncryption";arg5g.WPAEncryptionModes="AESEncryption";arg5g.WPAAuthenticationMode="PSKAuthentication";arg5g.IEEE11iAuthenticationMode="PSKAuthentication"}else{arg5g.IEEE11iEncryptionModes="AESEncryption";arg5g.WPAEncryptionModes="AESEncryption";arg5g.WPAAuthenticationMode="PSKAuthentication";arg5g.IEEE11iAuthenticationMode="PSKAuthentication"}arg5g.X_TP_PreSharedKey=$.qd.wl5g.pwd}else{arg5g.beaconType="Basic";arg5g.basicEncryptionModes="None";arg5g.BasicAuthenticationMode="None"}}else{arg5g.enable=0;if($.qd.wl5g.domain!=$.qd.dmRegion){arg5g.regulatoryDomain=$.qd.wl5g.domain;arg5g.autoChannelEnable=1}}if(needReboot==false){$.act(ACT_SET,LAN_WLAN,$.qd.wl.stack,null,arg2g);$.act(ACT_SET,LAN_WLAN,$.qd.wl5g.stack,null,arg5g);$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_wl5g"),"<span class='T T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true)}else{pushToCommitStack(ACT_SET,LAN_WLAN,$.qd.wl.stack,null,arg2g);pushToCommitStack(ACT_SET,LAN_WLAN,$.qd.wl5g.stack,null,arg5g);setTimeout(function(){$.removeLoading();$.h($.id("s_wl5g"),"<span class='T T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},1000)}break;case 8:if(!$.qd.iptv){return doSave($.qd.step++)}$.removeClass($.id("p_iptv"),"nd");$.addLoading($.id("s_iptv"));if($.qd.iptv.en){arg={enable:$.qd.iptv.en,iptvLanPort:$.qd.iptv.port,iptvVPI:$.qd.iptv.vpi,iptvVCI:$.qd.iptv.vci}}else{arg={enable:$.qd.iptv.en}}$.act(ACT_SET,DSL_IPTV_CFG,null,null,arg);$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_iptv"),"<span class='T T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true);break;case 9:if(!$.qd.voice){return doSave($.qd.step++)}if($.qd.type!="br"){$.removeClass($.id("p_voice"),"nd");$.addLoading($.id("s_voice"));var callFeature;var pstn;var dialPlan=[];var voipAccounts=[];if(null!=$.qd.voice.multiExtension&&""!=$.qd.voice.multiExtension){voipAccounts=$.act(ACT_GL,XTP_MULTI_ISP,null,null,["multiProfileName"]);if(0!=$.exe()){return}var stack=null;if(undefined!==$.qd.voice.__stack){if(undefined!==$.qd.voice.oldProfieNmme&&$.qd.voice.multiProfileName!=$.qd.voice.oldProfieNmme){if(undefined!==$.qd.voice.delAcc){stack=$.qd.voice.delAccStack}else{for(i=0;i<voipAccounts.length;i++){if(!voipAccounts[i].multiProfileName||voipAccounts[i].multiProfileName==""){break}}if(i<voipAccounts.length){stack=voipAccounts[i].__stack}else{stack=$.qd.voice.__stack}}}else{stack=$.qd.voice.__stack}}else{stack=voipAccounts[0].__stack}voipCodecs=$.act(ACT_GS,XTP_MULTIISP_CODEC_LIST,null,stack,["multiCodec","multiPacketizationPeriod","multiPriority"]);callFeature=$.act(ACT_GL,VOICE_PROF_LINE_CALLFEAT,null,null,["X_TP_OutgoingCallpriorAccount","CallForwardUnconditionalNumber","CallForwardOnBusyNumber","CallForwardOnNoAnswerNumber","X_TP_WarmLineNumber"]);pstn;if(SUPPORT_PSTN){pstn=$.act(ACT_GL,XTP_VOICE_PSTN,null,null,["IncomingCallRoutingAccount"])}dialPlan=$.act(ACT_GL,XTP_IGD_MULTIISPDP_LIST,null,null,["Attr"])}var voipVoiceServiceList=$.act(ACT_GL,VOICE,null,null,["X_TP_BoundIfName"]);if(0!=$.exe()){return}if(null!=$.qd.voice.multiProfileName&&""!=$.qd.voice.multiProfileName){var temp={};temp.multiProfileName=$.qd.voice.multiProfileName;temp.multiExtension=$.qd.voice.multiExtension;temp.multiDomain=$.qd.voice.multiDomain;temp.multiAuthUserName=$.qd.voice.multiAuthUserName;if($.qd.voice.passwordClear==true){temp.multiAuthPassword=$.qd.voice.multiAuthPassword}temp.multiRegistrarServer=$.qd.voice.multiRegistrarServer;temp.multiRegistrarServerPort=$.qd.voice.multiRegistrarServerPort;temp.multiRegisterViaOB=$.qd.voice.multiRegisterViaOB;if(true==$.qd.voice.obpAsReg){temp.multiOutboundProxy="0.0.0.0";temp.multiOutboundProxyPort=5060}else{temp.multiOutboundProxy=$.qd.voice.multiOutboundProxy;temp.multiOutboundProxyPort=$.qd.voice.multiOutboundProxyPort}if(true==$.qd.voice.sippAsReg){temp.multiProxyServer="0.0.0.0";temp.multiProxyServerPort=5060}else{temp.multiProxyServer=$.qd.voice.multiProxyServer;temp.multiProxyServerPort=$.qd.voice.multiProxyServerPort}temp.multiDisplayName="";temp.multiAccountPrior=4;if(VOICE_CAPABILITIES.maxLineCount>=2){temp.multiAccountInRoute=4}else{temp.multiAccountInRoute=1}temp.multiAccountMwi=0;$.act(ACT_SET,XTP_MULTI_ISP,stack,null,temp);var index=$.qd.voice.delAcc;var temp1={};$.each(voipCodecs,function(arg,i){temp1.multiPriority=(i+1)+"";temp1.multiPacketizationPeriod=20;$.act(ACT_SET,XTP_MULTIISP_CODEC_LIST,this.__stack,null,temp1)});if(undefined!==$.qd.voice.delAcc){var maxLine=VOICE_CAPABILITIES.maxLineCount;var newCallFeature=[];for(var i=0;i<maxLine;i++){newCallFeature[i]={}}var newPstn={};var warmLineList=[];for(var i=0;i<maxLine;i++){warmLineList[i]=callFeature[i].X_TP_WarmLineNumber.split(";")}for(i=0;i<maxLine;i++){if(index+1==parseInt(callFeature[i].X_TP_OutgoingCallpriorAccount,10)){newCallFeature[i].X_TP_OutgoingCallpriorAccount=valueOfAuto;newCallFeature[i].X_TP_OutgoingCallprior=0}if(SUPPORT_PSTN){if(index+1==parseInt(pstn[0].incomingCallRoutingAccount,10)){newPstn.incomingCallRoutingAccount=valueOfAuto;newPstn.incomingCallRoutingDest=""}}if(index+1==callFeature[i].callForwardUnconditionalNumber.split("@")[1]){newCallFeature[i].callForwardUnconditionalNumber=""}if(index+1==callFeature[i].callForwardOnBusyNumber.split("@")[1]){newCallFeature[i].callForwardOnBusyNumber=""}if(index+1==callFeature[i].callForwardOnNoAnswerNumber.split("@")[1]){newCallFeature[i].callForwardOnNoAnswerNumber=""}var j=0;while(j<warmLineList[i].length){if(index+1==warmLineList[i][j].split("@")[1]){warmLineList[i].splice(j,1)}else{j++}}}$.each(dialPlan,function(arg,j){if(((parseInt(this.attr,10)&SIP_MASK)>>>SIP_SHIFT)==(index+1)){$.act(ACT_DEL,XTP_IGD_MULTIISPDP_LIST,this.__stack,null,null)}})}}temp={};temp.X_TP_BoundIfName="Any_WAN";$.act(ACT_SET,VOICE,voipVoiceServiceList[0].__stack,null,temp);temp={};temp.region=$.qd.voice.region;$.act(ACT_SET,VOICE_PROF,$.qd.voice.region_stack,null,temp);actForSendMsg();$.exe(function(ret){if(ret){return doErr(ret)}$.removeLoading();$.h($.id("s_voice"),"<span class='T_success'>"+m_str.success+"</span>");$.qd.step++;doSave()},true)}else{$.qd.step++;doSave()}break;case 10:if($.qd.realMode!=$.qd.sysMode||needReboot==true){showReboot();pushToCommitStack(ACT_OP,ACT_OP_REBOOT);commitStack()}else{$.removeClass($.id("con_end1"),"nd");$.removeClass($.id("con_end3"),"nd");$.removeClass($.id("doEnd"),"nd")}$.unlock();break}}function doContinue(){var vpi=$.id("i_vpi").value;if($.num(vpi,[0,255],true)){return $.alert(ERR_WAN_VPI_VCI_INVAD)}var vci=$.id("i_vci").value;if($.num(vci,[1,65535],true)){return $.alert(ERR_WAN_VPI_VCI_INVAD)}pvc=vpi+"/"+vci;$.addClass($.id("doCont"),"nd");$.addClass($.id("p_auto"),"nd");$.addClass($.id("con_pvc"),"nd");$.lock();doSave()}function goPrev(){doCollect();$.qf.prev()}function doReboot(){$.guage(["<span class='T T_rebooting'>"+s_str.rebooting+"</span>","<span class='T_wait_reboot'>"+s_str.wait_reboot+"</span>"],100,$.guageInterval,function(){$.refresh()});$.act(ACT_OP,ACT_OP_REBOOT);$.exe(true)}function showReboot(){$.guage(["<span class='T T_rebooting'>"+s_str.rebooting+"</span>","<span class='T_wait_reboot'>"+s_str.wait_reboot+"</span>"],100,1100,function(){$.refresh()})}function doErr(errno){$.h($.id("_load").parentNode.getElementsByTagName("span")[0],"<i class='T T_fail'>"+m_str.fail+"</i>");$.removeLoading();$.h($.id("errinfo"),errno+": "+(e_str[errno]?e_str[errno]:e_str[ERR_UNKOWN]));$.removeClass($.id("con_end4"),"nd");$.removeClass($.id("doQuit"),"nd");$.unlock()};</script>
<p class="et T" id="et">Quick Setup - Complete</p>
<div class="con1 M">
    <p class="ct"></p>

    <p class="bl"></p>

    <div class="con2">
        <p class="T" id="t_stat">Setup Status:</p>

        <div id="info">
            <p class="L2 nd" id="p_sysMode"><b class="item XXL T" id="t_mode">Operation Mode Configuring:</b><span
                    id="s_sysMode"></span></p>

            <p class="L2 nd" id="p_auto"><b class="item XXL T" id="t_pvc">PVC Detecting:</b><span id="s_auto"></span>
            </p>

            <p class="L3 nd" id="p_pvc">PVC: <span id="s_pvc"></span></p>

            <p class="L2 nd" id="p_del"><b class="item XXL T" id="t_release">WAN Connection Releasing:</b><span
                    id="s_del"></span></p>

            <p class="L2 nd" id="p_wan"><b class="item XXL T" id="t_wan">WAN Connection Configuring:</b><span
                    id="s_wan"></span></p>

            <p class="L2 nd" id="p_3g"><b class="item XXL T" id="t_3g">3G Connection Configuring:</b><span
                    id="s_3g"></span></p>

            <p class="L2 nd" id="p_gw"><b class="item XXL T" id="t_gw">Gateway and DNS Configuring:</b><span
                    id="s_gw"></span></p>
            <p class="L2 nd" id="p_vlan"><b class="item XXL T" id="t_iptv">IPTV Configuring:</b><span
                    id="s_vlan"></span></p>
            <p class="L2 nd" id="p_wl"><b class="item XXL T" id="t_wl">Wi-Fi Configuring:</b><span id="s_wl"></span></p>

            <p class="L2 nd" id="p_wl2g"><b class="item XXL T" id="t_wl2g">Wireless 2.4GHz Configuring:</b><span
                    id="s_wl2g"></span></p>

            <p class="L2 nd" id="p_wl5g"><b class="item XXL T" id="t_wl5g">Wireless 5GHz Configuring:</b><span
                    id="s_wl5g"></span></p>

            <p class="L2 nd" id="p_iptv"><b class="item XXL T" id="t_iptv">IPTV Configuring:</b><span
                    id="s_iptv"></span></p>

            <p class="L2 nd" id="p_voice"><b class="item XXL T" id="qsend_conf_voice">Voice Configuring...</b><span
                    id="s_voice"></span></p>
        </div>
        <p class="br"></p>

        <div id="con_pvc" class="nd">
            <p class="T" id="t_fail">PVC Auto-detection failed. Please enter PVC parameters and click NEXT. If you don't
                known, please consult your ISP for the PVC information.</p>

            <p class="L2"><b class="item S">VPI:</b><input type="text" id="i_vpi" class="text" size="5" maxlength="3"/>
                (0-255)</p>

            <p class="L2"><b class="item S">VCI:</b><input type="text" id="i_vci" class="text" size="5" maxlength="5"/>
                (1-65535)</p>
        </div>
        <p id="con_end1" class="nd T">Quick Setup has completed. Please click Finish button to exit.</p>

        <p id="con_end2" class="nd T">Setup has completed! Please click REBOOT to restart the device and make the
            settings take effect.</p>

        <p id="con_end3" class="nd T" style="color:#c11c66;" >Note: If the device still can not connect to the Internet, please click "Network >
            WAN" menu on the left to confirm the WAN connection type and mode on the WAN page.</p>

        <div id="con_end4" class="nd"><p><b class="item T T_err">Error:</b>&nbsp;</p>

            <p class="center"><i id="errinfo">-</i></p>

            <p class="T" id="t_retry">Some configurations in the Quick Setup may be lost. Please try again.</p>

            <p class="T" id="t_def">If error appears again or the Internet connection is still off, please restore
                Router to its factory defaults and try again.</p></div>
    </div>
    <p class="bl"></p>

    <p class="tail ctr">
        <input type="button" id="doCont" class="button L nd T T_next" value="Next" onclick="doContinue()"/>
        <input type="button" id="doPrev" class="button L nd T T_back" value="Back" onclick="goPrev()"/>
        <input type="button" id="doEnd" class="button L nd T T_finish" value="Finish"
               onclick="window.parent.$.refresh();"/>
        <input type="button" id="doQuit" class="button L nd T T_quit" value="Quit"
               onclick="window.parent.$.refresh();"/>
        <input type="button" id="doReboot" class="button L nd T T_reboot" value="Reboot" onclick="doReboot()"/>
    </p>
</div>
<script language="javascript" type="text/javascript">(function(){$.loadHelpFrame("WzdFinishHelpRpm.htm");if(!$.mainParam){return $.loadMain("qsStart.htm")}$.lock();$.qd.step=0;$.timeout(doSave,100)})();</script>
